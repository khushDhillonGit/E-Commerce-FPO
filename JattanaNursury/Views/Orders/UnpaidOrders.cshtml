@model IEnumerable<JattanaNursury.ViewModels.OrderUnpaidModel>

<table id="ordersTable" class="table table-striped" data-detail-view="true"></table>

@section Scripts{
    <script>
        var obj = @Json.Serialize(Model);


        function dateFormatter(data, row, index) {
            const date = new Date(Date.parse(data));
            return date.toDateString();
        }
        function priceFormatter(data, row, index) {
            return '₹' + data;
        }
        $('#ordersTable').bootstrapTable({
            columns:
                [{
                    field: "orderNumber",
                    title: "Order#",
                    sortable: true,
                    align: 'right'
                }, {
                    field: "employee",
                    title: "Employee",
                    sortable: true,
                    align: 'right'
                }, {
                    field: "price",
                    title: "Price",
                    formatter: "priceFormatter",
                    sortable: true,
                    align: 'right'
                }, {
                    field: "discount",
                    title: "Discount",
                    sortable: true,
                    formatter: "priceFormatter",
                    align: 'right'
                }, {
                    field: "billPrice",
                    title: "Bill Price",
                    formatter: "priceFormatter",
                    sortable: true,
                    align: 'right'
                }, {
                    field: "paidByCustomer",
                    title: "Paid",
                    sortable: true,
                    formatter: "priceFormatter",
                    align: 'right'
                }, {
                    field: "orderDate",
                    title: "Order date",
                    sortable: true,
                    formatter: "dateFormatter",
                    align: 'right'
                }],
            data: obj,
            search: true,
            pagination: true,
            sortName: 'orderDate',
            sortOrder: 'desc',
            detailView: true,
            detailFormatter: 'productListFormatter'
        });
        function productListFormatter(index, row) {
            var tableRows = [];
            console.log(row);
            $.each(row.products, function (i, data) {

                tableRows.push(`<tr>
                        <th scope="row">${i + 1}</th>
                        <td>${data.name}</td>
                        <td>${data.quantity}</td>
                        <td>${data.unitPrice}</td>
                        <td>${data.sellingPrice}</td>
                        <td>${data.totalPrice}</td>
                    </tr>`);
            
            });
            var rows = tableRows.join('');
            var html = `<div class="row p-3">
                      <div class="col-12 d-flex justify-content-evenly">
                        <p>${row.customerName}</p>
                        <p>${row.customerPhone}</p>
                        <p>${row.customerAddress}</p>
                      </div>
                      <div class="col-12">
                        <table class="table">
                          <thead>
                            <tr>
                              <th scope="col">#</th>
                              <th scope="col">Name</th>
                              <th scope="col">Quantity</th>
                              <th scope="col">Unit Price</th>
                              <th scope="col">Selling Price</th>
                              <th scope="col">Total</th>
                            </tr>
                          </thead>
                          <tbody>
                            ${rows}
                          </tbody>
                        </table>
                      </div>
                    </div>`;

            console.log(html);
            return html;
        }
    </script>

}